import{b as Y,a as j,_ as U}from"./index-429ff8e5.js";/* empty css                   *//* empty css                 */import{i as _}from"./index-e0333ef0.js";import{f as O}from"./index-9b3e9b96.js";import{q as V,s as q,a as F,t as H}from"./index-57f530b0.js";import{d as P,f as l,w as z,g as J,C as i,D as n,W as f,N as T,Y as Q,O as Z,P as $,M as u,a3 as ee}from"./element-plus-dc5e6ec0.js";const p=h=>(Z("data-v-621d0ed8"),h=h(),$(),h),te={class:"graphinfo-wrap"},ae={class:"userinfo-charts"},se={key:1,class:"chart",style:{width:"540px"}},oe=p(()=>n("div",{style:{display:"flex","justify-content":"center"}},[n("h3",null,"浏览文章关键词统计")],-1)),le={key:1,class:"chart",style:{width:"540px"}},re=p(()=>n("div",{style:{display:"flex","justify-content":"center"}},[n("h3",null,"发布文章类别统计")],-1)),ne=p(()=>n("br",null,null,-1)),ce=p(()=>n("br",null,null,-1)),ie=p(()=>n("br",null,null,-1)),ue=p(()=>n("br",null,null,-1)),de=P({__name:"GraphInfo",setup(h){const y=l(),v=l(),m=l(),g=l(),B=Y(),{userStore:G,keywordStore:x}=j(),d=l(0),b=l([]),S=l([]),c=l([]),A=l([]),E=l([]),w=l(!1),D=l(!1),r=l([!1,!1,!1,!1]),I=(s,e)=>new Date(s.replace(/-/g,"/"))>new Date(e.replace(/-/g,"/")),C=s=>{let e=String(s);return s.toString().length===1&&(e="0"+String(s)),e},L=s=>{let e=new Date,t=e.getTime()+1e3*60*60*24*s;e.setTime(t);let a=e.getFullYear(),o=e.getMonth(),k=e.getDate();const W=C(o+1),X=C(k);return a+"-"+W+"-"+X},M=async()=>{if(y.value){r.value[0]=!0;const s=_(y.value);if(d.value===G.userInfo.user_id)if(x.keywordInfo.length>0){const e=x.keywordInfo.sort((a,o)=>o.keywords_count-a.keywords_count).slice(0,5).map(a=>({name:a.keywords_name,value:a.keywords_count})),t={title:{text:"浏览文章关键词统计",x:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{name:"类别",type:"pie",radius:"55%",center:["50%","60%"],data:e,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};s.setOption(t)}else w.value=!0;else{const e=(await F({user_id:d.value})).result;if(e.length>0){const t=e.sort((o,k)=>k.keywords_count-o.keywords_count).slice(0,5).map(o=>({name:o.keywords_name,value:o.keywords_count})),a={title:{text:"浏览文章关键词统计",x:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{name:"类别",type:"pie",radius:"55%",center:["50%","60%"],data:t,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};s.setOption(a)}else w.value=!0}r.value[0]=!1}},R=async()=>{if(v.value){r.value[1]=!0;const s=_(v.value),e=await H({user_id:d.value});let t=[];e.result_code===0&&(e.result.length>0?t=e.result.map(o=>({name:o.tag_name,value:o.count})):D.value=!0);const a={title:{text:"发布文章类别统计",x:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},series:[{name:"类别",type:"pie",radius:"55%",center:["50%","60%"],data:t,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};s.setOption(a),r.value[1]=!1}},N=()=>{if(m.value){r.value[2]=!0;const s=_(m.value),e={title:{text:"点赞数据"},tooltip:{trigger:"axis"},legend:{data:["点赞量"]},grid:{top:"15%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:c.value},yAxis:{type:"value"},series:[{name:"点赞量",type:"line",stack:"Total",data:A.value,smooth:!0,itemStyle:{color:"skyblue"},lineStyle:{color:"skyblue"}}]};s.setOption(e),r.value[2]=!1}},K=()=>{if(g.value){r.value[3]=!0;const s=_(g.value),e={title:{text:"收藏数据"},tooltip:{trigger:"axis"},legend:{data:["收藏量"]},grid:{top:"15%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:c.value},yAxis:{type:"value"},series:[{name:"收藏量",type:"line",stack:"Total",data:E.value,smooth:!0,itemStyle:{color:"gray"},lineStyle:{color:"gray"}}]};s.setOption(e),r.value[3]=!1}};return z(()=>B.params.user_id,(s,e)=>{d.value=Number(s)},{immediate:!0}),J(async()=>{for(;c.value.length<10;){let t=L(c.value.length-10);c.value.push(t)}(await V({user_id:d.value})).result.forEach(t=>{b.value.push(t)}),c.value.forEach(t=>{let a=0;b.value.forEach(o=>{I(t,O(o.createdAt))&&a++}),A.value.push(a)}),(await q({user_id:d.value})).result.forEach(t=>{S.value.push(t)}),c.value.forEach(t=>{let a=0;S.value.forEach(o=>{I(t,O(o.createdAt))&&a++}),E.value.push(a)}),setTimeout(()=>{M(),R(),N(),K()},100)}),(s,e)=>{const t=ee,a=Q;return u(),i("div",te,[n("div",ae,[f((u(),i("div",null,[w.value?(u(),i("div",se,[oe,T(t,{description:"暂无数据"})])):(u(),i("div",{key:0,ref_key:"keywordschart",ref:y,class:"chart",style:{width:"540px"}},null,512))])),[[a,r.value[0]]]),f((u(),i("div",null,[D.value?(u(),i("div",le,[re,T(t,{description:"暂无数据"})])):(u(),i("div",{key:0,ref_key:"articletagschart",ref:v,class:"chart",style:{width:"540px"}},null,512))])),[[a,r.value[1]]])]),ne,ce,f(n("div",{ref_key:"likedatachart",ref:m,class:"chart"},null,512),[[a,r.value[2]]]),ie,ue,f(n("div",{ref_key:"collectdatachart",ref:g,class:"chart"},null,512),[[a,r.value[3]]])])}}});const ge=U(de,[["__scopeId","data-v-621d0ed8"]]);export{ge as default};
